<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin - Order Detail</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 30px; }
        h2 { margin-bottom: 10px; }
        .box { border: 1px solid #ddd; padding: 14px; margin-top: 10px; }
        .row { margin: 6px 0; }
        .label { color: #666; display: inline-block; width: 140px; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; vertical-align: top; }
        th { background: #f5f5f5; }
        .btn { cursor: pointer; width: auto; padding: 6px 10px; display: inline-block; text-decoration: none; }
        .muted { color: #666; font-size: 13px; }

        .status-wrap { display: inline-flex; gap: 10px; align-items: center; }
        select, button { padding: 6px 10px; }
    </style>
</head>
<body>

<h2>Order Detail</h2>

<a class="btn" th:href="@{/admin/orders}">← Back to list</a>

<div class="box">
    <div class="row"><span class="label">Order ID:</span> <span th:text="${order.orderId}"></span></div>
    <div class="row"><span class="label">Order Code:</span> <span th:text="${order.orderCode}"></span></div>

    <!-- ✅ Status + Update form -->
    <div class="row">
        <span class="label">Status:</span>
        <span class="status-wrap">
            <strong th:text="${order.status}"></strong>

            <form method="post"
                  th:action="@{/admin/orders/{id}/status(id=${order.orderId})}"
                  style="display:inline-flex; gap:10px; align-items:center; margin:0;">
                <!-- Nếu bạn bật Spring Security CSRF thì mở dòng này -->
                <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"> -->

                <select name="status">
                    <option th:each="s : ${statuses}"
                            th:value="${s}"
                            th:text="${s}"
                            th:selected="${s == order.status}">
                    </option>
                </select>

                <button class="btn" type="submit">Update</button>
            </form>
        </span>
    </div>

    <div class="row"><span class="label">Placed At:</span> <span th:text="${order.placedAt}"></span></div>
    <div class="row"><span class="label">Phone:</span> <span th:text="${order.phone}"></span></div>
    <div class="row"><span class="label">Address:</span> <span th:text="${order.address}"></span></div>
    <div class="row"><span class="label">Total:</span> <span th:text="${order.total}"></span></div>
</div>

<h3 style="margin-top: 18px;">Items</h3>

<table>
    <thead>
    <tr>
        <th>#</th>
        <th>Product Name</th>
        <th>Unit Price</th>
        <th>Quantity</th>
        <th>Line Total</th>
    </tr>
    </thead>
    <tbody>
    <tr th:if="${order.items == null || #lists.isEmpty(order.items)}">
        <td colspan="5" class="muted">No items.</td>
    </tr>

    <tr th:each="it, st : ${order.items}">
        <td th:text="${st.count}"></td>
        <td th:text="${it.productName}"></td>
        <td th:text="${it.unitPrice}"></td>
        <td th:text="${it.quantity}"></td>
        <td th:text="${it.lineTotal}"></td>
    </tr>
    </tbody>
</table>

</body>
</html>
