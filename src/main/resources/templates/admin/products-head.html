<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="head">
  <style>
    /* Search Section */
    .search-section {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .search-section p {
      color: #666;
      margin-bottom: 15px;
      font-size: 14px;
    }

    .search-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .search-input {
      flex: 1;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    .btn-primary { background: #007bff; color: #fff; }
    .btn-primary:hover { background: #0056b3; }
    .btn-success { background: #28a745; color: #fff; }
    .btn-success:hover { background: #218838; }
    .btn-secondary { background: #6c757d; color: #fff; }
    .btn-secondary:hover { background: #5a6268; }
    .btn-warning { background: #ffc107; color: #000; }
    .btn-warning:hover { background: #e0a800; }
    .btn-danger { background: #dc3545; color: #fff; }
    .btn-danger:hover { background: #c82333; }
    .btn-sm { padding: 5px 10px; font-size: 12px; }

    /* Products Table */
    .products-section {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .section-header h2 {
      font-size: 18px;
      color: #333;
    }

    .total-count {
      color: #666;
      font-size: 14px;
    }

    .table-wrapper {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: #f8f9fa;
    }

    th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: #333;
      font-size: 14px;
      border-bottom: 2px solid #dee2e6;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #dee2e6;
      font-size: 14px;
      color: #555;
    }

    tbody tr:hover {
      background: #f8f9fa;
    }

    .product-image {
      width: 50px;
      height: 75px;
      object-fit: cover;
      border-radius: 4px;
    }

    /* Stock Badges */
    .stock-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .stock-active { background: #d4edda; color: #155724; }
    .stock-low { background: #fff3cd; color: #856404; }
    .stock-out { background: #f8d7da; color: #721c24; }

    .action-buttons {
      display: flex;
      gap: 5px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      overflow-y: auto;
    }

    .modal.active {
      display: block;
    }

    .modal-content {
      background: #fff;
      margin: 50px auto;
      padding: 30px;
      border-radius: 8px;
      max-width: 600px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }

    .modal-header h2 {
      font-size: 20px;
      color: #333;
    }

    .close-btn {
      font-size: 28px;
      color: #999;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      line-height: 1;
    }

    .close-btn:hover {
      color: #333;
    }

    /* Form */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #333;
      font-size: 14px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #dee2e6;
    }
  </style>

  <script>
    const AdminProduct = {
      updateCount() {
        const visibleRows = document.querySelectorAll('#productsTable tbody tr:not([style*="display: none"])');
        const countElement = document.querySelector('.total-count strong');
        if (countElement) {
          countElement.textContent = visibleRows.length;
        }
      },

      initSearch() {
        const searchInput = document.getElementById('searchInput');
        if (!searchInput) return;

        searchInput.addEventListener('input', (e) => {
          AppUtils.searchTable(e.target.value, '#productsTable', () => this.updateCount());
        });
      },

      loadProductData(productId) {
        return fetch(`/admin/products/${productId}`)
                .then(response => {
                  if (!response.ok) throw new Error('Failed to load product');
                  return response.json();
                });
      },

      populateForm(data) {
        document.getElementById('productId').value = data.productId;
        document.getElementById('name').value = data.name;
        document.getElementById('description').value = data.description || '';
        document.getElementById('imageUrl').value = data.imageUrl || '';
        document.getElementById('price').value = data.price;
        document.getElementById('publishYear').value = data.publishYear || '';
        document.getElementById('stock').value = data.stock;
        document.getElementById('status').value = data.status;
        document.getElementById('categoryId').value = data.categoryId;
        document.getElementById('publisherId').value = data.publisherId;
        document.getElementById('supplierId').value = data.supplierId;

        // Select authors
        const authorSelect = document.getElementById('authorIds');
        Array.from(authorSelect.options).forEach(option => {
          option.selected = data.authors && data.authors.some(author => author.authorId == option.value);
        });
      }
    };

    // Global functions for HTML onclick
    function clearSearch() {
      document.getElementById('searchInput').value = '';
      document.querySelectorAll('#productsTable tbody tr').forEach(row => row.style.display = '');
      AdminProduct.updateCount();
    }

    function openAddModal() {
      document.getElementById('modalTitle').textContent = 'Thêm sách mới';
      document.getElementById('productForm').reset();
      document.getElementById('productId').value = '';
      document.getElementById('productModal').classList.add('active');
    }

    function openEditModal(productId) {
      document.getElementById('modalTitle').textContent = 'Chỉnh sửa thông tin sách';

      AdminProduct.loadProductData(productId)
              .then(data => {
                AdminProduct.populateForm(data);
                document.getElementById('productModal').classList.add('active');
              })
              .catch(error => alert('Lỗi khi tải thông tin sản phẩm: ' + error.message));
    }

    function closeModal() {
      document.getElementById('productModal').classList.remove('active');
    }

    function deleteProduct(productId, productName) {
      if (!confirm(`Bạn có chắc chắn muốn xóa sách "${productName}"?`)) return;

      const form = document.createElement('form');
      form.method = 'POST';
      form.action = `/admin/products/delete/${productId}`;
      document.body.appendChild(form);
      form.submit();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      AdminProduct.initSearch();

      // Close modal when clicking outside
      window.addEventListener('click', (event) => {
        const modal = document.getElementById('productModal');
        if (event.target === modal) closeModal();
      });
    });
  </script>
</th:block>
</script>
</th:block>