<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="body">
    <!-- Search Section -->
    <div class="search-section">
        <p>Gõ là ra kết quả ngay. Search theo: tên, mô tả, tác giả, nhà xuất bản, nhà cung cấp, thể loại.</p>
        <div class="search-controls">
            <input type="text" class="search-input" id="searchInput" placeholder="Nhập từ khóa để tìm sách...">
            <button class="btn btn-secondary" onclick="clearSearch()">Xóa lọc</button>
            <button class="btn btn-success" onclick="openAddModal()">+ Thêm sách mới</button>
        </div>
    </div>

    <!-- Products Table -->
    <div class="products-section">
        <div class="section-header">
            <h2>Danh sách sản phẩm</h2>
            <span class="total-count">Tổng: <strong th:text="${#lists.size(products)}">0</strong> cuốn</span>
        </div>

        <div class="table-wrapper">
            <table id="productsTable">
                <thead>
                    <tr>
                        <th>Mã</th>
                        <th>Ảnh</th>
                        <th>Tên sách</th>
                        <th>Thể loại</th>
                        <th>Giá</th>
                        <th>Tồn kho</th>
                        <th>Tác giả</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="product : ${products}">
                        <td th:text="${product.productId}">1</td>
                        <td>
                            <img th:src="${product.imageUrl}" 
                                 alt="Book Cover" 
                                 class="product-image"
                                 onerror="this.src='https://placehold.co/50x75?text=No+Image'">
                        </td>
                        <td>
                            <strong th:text="${product.name}">Mắt Biếc</strong>
                            <div style="font-size: 12px; color: #999;" 
                                 th:text="'Năm xuất bản: ' + ${product.publishYear}">
                                Năm xuất bản: 2019
                            </div>
                        </td>
                        <td th:text="${product.category.name}">Tiểu thuyết</td>
                        <td th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 2, 'POINT')}">89,000.00</td>
                        <td>
                            <span class="stock-badge"
                                  th:classappend="${product.stock > 50} ? 'stock-active' : (${product.stock > 0} ? 'stock-low' : 'stock-out')"
                                  th:text="${product.stock}">
                                120
                            </span>
                        </td>
                        <td>
                            <span th:each="author, iterStat : ${product.authors}">
                                <span th:text="${author.name}">Nguyễn Nhật Ánh</span>
                                <span th:if="${!iterStat.last}">, </span>
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-warning btn-sm" 
                                        th:data-product-id="${product.productId}"
                                        onclick="openEditModal(this.dataset.productId)">
                                    Sửa
                                </button>
                                <button class="btn btn-danger btn-sm" 
                                        th:data-product-id="${product.productId}"
                                        th:data-product-name="${product.name}"
                                        onclick="deleteProduct(this.dataset.productId, this.dataset.productName)">
                                    Xóa
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Thêm sách mới</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="productForm" th:action="@{/admin/products/save}" method="post">
                <input type="hidden" id="productId" name="productId">
                
                <div class="form-group">
                    <label for="name">Tên sách *</label>
                    <input type="text" id="name" name="name" required>
                </div>

                <div class="form-group">
                    <label for="description">Mô tả</label>
                    <textarea id="description" name="description"></textarea>
                </div>

                <div class="form-group">
                    <label for="imageUrl">URL Hình ảnh</label>
                    <input type="text" id="imageUrl" name="imageUrl">
                </div>

                <div class="form-group">
                    <label for="price">Giá *</label>
                    <input type="number" id="price" name="price" step="0.01" required>
                </div>

                <div class="form-group">
                    <label for="publishYear">Năm xuất bản</label>
                    <input type="number" id="publishYear" name="publishYear">
                </div>

                <div class="form-group">
                    <label for="stock">Số lượng tồn kho *</label>
                    <input type="number" id="stock" name="stock" required>
                </div>

                <div class="form-group">
                    <label for="status">Trạng thái *</label>
                    <select id="status" name="status" required>
                        <option value="ACTIVE">ACTIVE</option>
                        <option value="OUT_OF_STOCK">OUT_OF_STOCK</option>
                        <option value="DISCONTINUED">DISCONTINUED</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="categoryId">Thể loại *</label>
                    <select id="categoryId" name="categoryId" required>
                        <option th:each="category : ${categories}" 
                                th:value="${category.categoryId}" 
                                th:text="${category.name}">
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="publisherId">Nhà xuất bản *</label>
                    <select id="publisherId" name="publisherId" required>
                        <option th:each="publisher : ${publishers}" 
                                th:value="${publisher.publisherId}" 
                                th:text="${publisher.name}">
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="supplierId">Nhà cung cấp *</label>
                    <select id="supplierId" name="supplierId" required>
                        <option th:each="supplier : ${suppliers}" 
                                th:value="${supplier.supplierId}" 
                                th:text="${supplier.name}">
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="authorIds">Tác giả *</label>
                    <select id="authorIds" name="authorIds" multiple size="5" required>
                        <option th:each="author : ${authors}" 
                                th:value="${author.authorId}" 
                                th:text="${author.name}">
                        </option>
                    </select>
                    <small style="color: #666;">Giữ Ctrl (Cmd trên Mac) để chọn nhiều tác giả</small>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Hủy</button>
                    <button type="submit" class="btn btn-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</th:block>