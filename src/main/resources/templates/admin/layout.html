<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:fragment="layout(pageTitle, activeMenu, pageHead, pageBody, user)">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle} ?: 'Admin'">Admin</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f5f5;
        }

        .app {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 256px;
            background: #1a1d29;
            color: #fff;
            padding: 20px 0;
            transition: width 0.2s ease, padding 0.2s ease;
            overflow: hidden;
        }

        .app.sidebar-collapsed .sidebar {
            width: 0;
            padding: 0;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #2a2d3a;
        }

        .sidebar-header h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 13px;
            color: #8a8d9a;
        }

        .sidebar-menu {
            margin-top: 20px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #8a8d9a;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 3px solid transparent;
        }

        .menu-item:hover,
        .menu-item.active {
            background: #2a2d3a;
            color: #fff;
            border-left-color: #5b9bd5;
        }

        .menu-item span {
            margin-left: 10px;
        }

        /* Main Content */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .topbar {
            height: 56px;
            background: #fff;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .topbar h1 {
            font-size: 24px;
            color: #333;
        }

        .toggle-btn {
            height: 36px;
            width: 36px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            background: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #dc3545;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .page {
            flex: 1;
            padding: 30px;
            overflow: auto;
        }

        /* Alert Messages */
        .alert {
            padding: 12px 20px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>

    <!-- App Utilities (Common for entire application) -->
    <script th:src="@{/js/app-utils.js}"></script>

    <th:block th:replace="${pageHead} ?: ~{}"></th:block>
</head>

<body>
<div class="app" id="adminApp">
    <aside class="sidebar">
        <div class="sidebar-header">
            <h3>ADMIN PANEL</h3>
            <p th:text="${user.fullName}">Admin Name</p>
            <p th:text="${user.email}">admin@example.com</p>
        </div>

        <nav class="sidebar-menu">
            <a th:href="@{/admin/dashboard}" 
               class="menu-item"
               th:classappend="${activeMenu}=='dashboard' ? ' active' : ''">
                <span>üìä</span>
                <span>Th·ªëng k√™</span>
            </a>
            
            <a th:href="@{/admin}" 
               class="menu-item"
               th:classappend="${activeMenu}=='products' ? ' active' : ''">
                <span>üìö</span>
                <span>Qu·∫£n l√Ω s√°ch</span>
            </a>
            
            <a th:href="@{/admin/staff}" 
               class="menu-item"
               th:classappend="${activeMenu}=='staff' ? ' active' : ''">
                <span>üë•</span>
                <span>Qu·∫£n l√Ω nh√¢n vi√™n</span>
            </a>
            
            <a th:href="@{/admin/customers}" 
               class="menu-item"
               th:classappend="${activeMenu}=='customers' ? ' active' : ''">
                <span>üë§</span>
                <span>Qu·∫£n l√Ω kh√°ch h√†ng</span>
            </a>
        </nav>
    </aside>

    <main class="content">
        <div class="topbar">
            <div class="topbar-left">
                <button class="toggle-btn" id="toggleSidebarBtn" type="button">‚ò∞</button>
                <h1 th:text="${pageTitle} ?: 'Admin'">Admin</h1>
            </div>
            <a th:href="@{/logout}" class="logout-btn">ƒêƒÉng xu·∫•t</a>
        </div>

        <!-- Alert Messages -->
        <div class="page">
            <div th:if="${message}" class="alert alert-success" id="successAlert">
                <span th:text="${message}"></span>
            </div>
            <div th:if="${error}" class="alert alert-danger" id="errorAlert">
                <span th:text="${error}"></span>
            </div>

            <th:block th:replace="${pageBody}"></th:block>
        </div>
    </main>
</div>

<script>
    (function () {
        const key = "admin_sidebar_collapsed";
        const app = document.getElementById("adminApp");
        const btn = document.getElementById("toggleSidebarBtn");

        function apply(collapsed) {
            if (!app) return;
            app.classList.toggle("sidebar-collapsed", collapsed);
        }

        apply(localStorage.getItem(key) === "1");

        if (btn) {
            btn.addEventListener("click", function () {
                const collapsed = !app.classList.contains("sidebar-collapsed");
                apply(collapsed);
                localStorage.setItem(key, collapsed ? "1" : "0");
            });
        }

        // Auto hide alerts after 5 seconds
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => alert.style.display = 'none');
        }, 5000);
    })();
</script>
</body>
</html>
