<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chi Ti·∫øt ƒê∆°n H√†ng</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body { font-family: Arial, sans-serif; background: #f5f7fa; }
        .container { max-width: 1000px; margin: 20px auto; padding: 20px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,.1); }
        .card-header { background: linear-gradient(135deg,#667eea,#764ba2); color:white; padding:25px; }
        .card-body { padding:30px; }
        .section { margin-bottom:30px; }
        .section-title { font-weight:bold; margin-bottom:15px; border-bottom:2px solid #eee; padding-bottom:8px; }
        .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; }
        .label { font-size:12px; color:#777; text-transform:uppercase; }
        .value { font-size:15px; font-weight:600; }

        .status-badge {
            padding:6px 14px;
            border-radius:20px;
            font-size:12px;
            font-weight:bold;
            text-transform:uppercase;
            display:inline-block;
        }

        .status-awaiting_payment { background:#ffe8cc; color:#8a4b08; }
        .status-processing { background:#cce5ff; color:#004085; }
        .status-shipping { background:#d4edda; color:#155724; }
        .status-completed { background:#d4edda; color:#155724; }
        .status-cancelled { background:#f8d7da; color:#721c24; }
        .status-returned { background:#f1f1f1; color:#333; }

        .payment-pending { background:#fff3cd; color:#856404; }
        .payment-success { background:#d4edda; color:#155724; }
        .payment-failed { background:#f8d7da; color:#721c24; }

        table { width:100%; border-collapse:collapse; }
        th, td { padding:10px; text-align:left; border-bottom:1px solid #eee; }

        .actions { display:flex; gap:12px; margin-top:20px; }
        .btn { padding:10px 20px; border-radius:8px; font-weight:bold; text-decoration:none; border:none; cursor:pointer; }
        .btn-primary { background:linear-gradient(135deg,#667eea,#764ba2); color:white; }
        .btn-danger { background:#e74c3c; color:white; }
        .btn-secondary { background:#f1f1f1; border:1px solid #ccc; }
    </style>
</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>

<div class="container">
    <a href="/orders" class="btn btn-secondary">‚Üê Quay l·∫°i</a>

    <div class="card">
        <div class="card-header">
            <h2 th:text="'ƒê∆°n h√†ng #' + ${order.orderCode}"></h2>
            <div th:text="'Ng√†y ƒë·∫∑t: ' + ${#temporals.format(order.placedAt,'dd/MM/yyyy HH:mm:ss')}"></div>
        </div>

        <div class="card-body">

            <!-- TH√îNG TIN ƒê∆†N -->
            <div class="section">
                <div class="section-title">üì¶ Th√¥ng tin ƒë∆°n h√†ng</div>
                <div class="grid">
                    <div>
                        <div class="label">Tr·∫°ng th√°i ƒë∆°n</div>
                        <span class="status-badge"
                              th:classappend="'status-' + ${#strings.toLowerCase(order.status.name())}"
                              th:switch="${order.status.name()}">
                            <span th:case="'AWAITING_PAYMENT'">Ch·ªù thanh to√°n</span>
                            <span th:case="'PROCESSING'">ƒêang x·ª≠ l√Ω</span>
                            <span th:case="'SHIPPING'">ƒêang giao h√†ng</span>
                            <span th:case="'COMPLETED'">Ho√†n th√†nh</span>
                            <span th:case="'CANCELLED'">ƒê√£ h·ªßy</span>
                            <span th:case="'RETURNED'">Ho√†n tr·∫£</span>
                        </span>
                    </div>

                    <div>
                        <div class="label">T·ªïng ti·ªÅn</div>
                        <div class="value"
                             th:text="${#numbers.formatDecimal(order.total,0,'COMMA',0,'POINT')} + ' VNƒê'">
                        </div>
                    </div>
                </div>
            </div>

            <!-- DANH S√ÅCH S√ÅCH -->
            <div class="section">
                <div class="section-title">üìö S√°ch ƒë√£ mua</div>
                <table>
                    <thead>
                    <tr>
                        <th>S√°ch</th>
                        <th>Gi√°</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>Th√†nh ti·ªÅn</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="item : ${orderItems}">
                        <td style="display:flex; gap:12px; align-items:center">
                            <img th:if="${item.product.imageUrl != null}"
                                 th:src="${item.product.imageUrl}"
                                 style="width:60px; height:80px; object-fit:cover; border-radius:6px">
                            <span th:text="${item.productNameSnapshot}"></span>
                        </td>
                        <td th:text="${#numbers.formatDecimal(item.unitPriceSnapshot,0,'COMMA',0,'POINT')} + ' VNƒê'"></td>
                        <td th:text="${item.quantity}"></td>
                        <td style="font-weight:bold"
                            th:text="${#numbers.formatDecimal(item.lineTotal,0,'COMMA',0,'POINT')} + ' VNƒê'">
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- THANH TO√ÅN -->
            <div class="section" th:if="${paymentTransaction != null}">
                <div class="section-title">üí≥ Thanh to√°n</div>
                <div class="grid">
                    <div>
                        <div class="label">C·ªïng thanh to√°n</div>
                        <div class="value" th:text="${paymentTransaction.provider}"></div>
                    </div>
                    <div>
                        <div class="label">Tr·∫°ng th√°i</div>
                        <span class="status-badge"
                              th:classappend="'payment-' + ${#strings.toLowerCase(paymentTransaction.status.name())}"
                              th:switch="${paymentTransaction.status.name()}">
                            <span th:case="'PENDING'">Ch·ªù thanh to√°n</span>
                            <span th:case="'SUCCESS'">Th√†nh c√¥ng</span>
                            <span th:case="'FAILED'">Th·∫•t b·∫°i</span>
                        </span>
                    </div>
                    <div th:if="${paymentTransaction.txnRef != null}">
                        <div class="label">M√£ giao d·ªãch</div>
                        <div class="value" th:text="${paymentTransaction.txnRef}"></div>
                    </div>
                </div>
            </div>

            <!-- ACTION -->
            <div class="actions" th:if="${canCancel}">
                <form th:action="@{/orders/cancel}" method="post">
                    <input type="hidden" name="orderId" th:value="${order.orderId}">
                    <button type="submit" class="btn btn-danger">
                        H·ªßy ƒë∆°n
                    </button>
                </form>
            </div>


        </div>
    </div>
</div>
</body>
</html>
