<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="body">

  <style>
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; }
    .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .row.space { justify-content:space-between; }
    .muted { color:#6b7280; font-size:12px; }

    .tabs { display:flex; gap:8px; flex-wrap:wrap; }
    .tab {
      display:inline-flex; align-items:center; gap:8px;
      height:34px; padding:0 12px; border-radius:999px;
      border:1px solid #e5e7eb; background:#fff;
      font-size:13px; text-decoration:none; color:#111827;
    }
    .tab:hover { background:#f3f4f6; }
    .tab.active { background:#111827; border-color:#111827; color:#fff; }

    .badge {
      display:inline-flex; align-items:center; gap:6px;
      padding:4px 10px; border-radius:999px; font-size:12px;
      border:1px solid #e5e7eb; background:#f9fafb; color:#111827;
      white-space:nowrap;
    }
    .btn {
      display:inline-flex; align-items:center; gap:6px;
      height:34px; padding:0 12px; border-radius:10px;
      border:1px solid #e5e7eb; background:#fff; cursor:pointer;
      font-size:13px; color:#111827; text-decoration:none;
    }
    .btn:hover { background:#f3f4f6; }
    .btn.primary { background:#111827; color:#fff; border-color:#111827; }
    .btn.primary:hover { background:#0b1220; }
    .btn.danger { background:#fff; border-color:#fecaca; color:#b91c1c; }
    .btn.danger:hover { background:#fef2f2; }

    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { text-align:left; padding:10px 10px; border-top:1px solid #e5e7eb; font-size:13px; vertical-align:top; }
    th { background:#f9fafb; font-weight:600; border-top:none; }
    .actions { display:flex; gap:8px; flex-wrap:wrap; }
    .empty { padding:16px; text-align:center; color:#6b7280; }
    .code { font-weight:700; }
  </style>

  <div class="card">
    <div class="row space">
      <div>
        <div style="font-weight:700; font-size:16px;">Qu·∫£n l√Ω ƒë∆°n h√†ng</div>
      </div>
    </div>

    <!-- Tabs theo status -->
    <div class="tabs" style="margin-top:12px;">
      <a class="tab"
         th:href="@{/staff/orders(status='PROCESSING')}"
         th:classappend="${statusFilter == 'PROCESSING'} ? ' active' : ''">
        üü° PROCESSING
      </a>

      <a class="tab"
         th:href="@{/staff/orders(status='CONFIRMED')}"
         th:classappend="${statusFilter == 'CONFIRMED'} ? ' active' : ''">
        üîµ CONFIRMED
      </a>

      <a class="tab"
         th:href="@{/staff/orders(status='SHIPPING')}"
         th:classappend="${statusFilter == 'SHIPPING'} ? ' active' : ''">
        üü£ SHIPPING
      </a>

      <a class="tab"
         th:href="@{/staff/orders(status='COMPLETED')}"
         th:classappend="${statusFilter == 'COMPLETED'} ? ' active' : ''">
        üü¢ COMPLETED
      </a>

      <a class="tab"
         th:href="@{/staff/orders(status='CANCELLED')}"
         th:classappend="${statusFilter == 'CANCELLED'} ? ' active' : ''">
        üî¥ CANCELLED
      </a>
    </div>

    <!-- B·∫¢NG gi·ªØ y nguy√™n nh∆∞ b·∫°n ƒëang c√≥ -->
    <table>
      <thead>
      <tr>
        <th style="width:160px;">M√£ ƒë∆°n</th>
        <th>Kh√°ch / Li√™n h·ªá</th>
        <th style="width:150px;">T·ªïng ti·ªÅn</th>
        <th style="width:190px;">Th·ªùi gian</th>
        <th style="width:170px;">Tr·∫°ng th√°i</th>
        <th style="width:320px;">Thao t√°c</th>
      </tr>
      </thead>

      <tbody>
      <tr th:if="${orders == null or #lists.isEmpty(orders)}">
        <td colspan="6" class="empty">Kh√¥ng c√≥ ƒë∆°n h√†ng ph√π h·ª£p.</td>
      </tr>

      <tr th:each="o : ${orders}">
        <td>
          <div class="code" th:text="${o.orderCode}">ODR-XXXX</div>
          <div class="muted">#<span th:text="${o.orderId}">1</span></div>
        </td>

        <td>
          <div>
            <!-- n·∫øu User kh√¥ng c√≥ fullName th√¨ ƒë·ªïi sang email -->
            <span th:text="${o.user != null ? o.user.fullName  : 'N/A'}">Customer</span>
          </div>
          <div class="muted">
            <span th:text="${o.phone}">phone</span> ‚Ä¢
            <span th:text="${o.address}">address</span>
          </div>
        </td>

        <td>
          <div th:text="${#numbers.formatDecimal(o.total, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'">0 ‚Ç´</div>
        </td>

        <td><div th:text="${o.placedAt}">time</div></td>

        <td>
          <span class="badge"
                th:text="${o.status.name() == 'PROCESSING' ? 'üü° Ch·ªù x√°c nh·∫≠n' :
                         (o.status.name() == 'CONFIRMED' ? 'üîµ ƒê√£ x√°c nh·∫≠n' :
                         (o.status.name() == 'SHIPPING' ? 'üü£ ƒêang giao' :
                         (o.status.name() == 'COMPLETED' ? 'üü¢ Ho√†n t·∫•t' :
                         (o.status.name() == 'CANCELLED' ? 'üî¥ ƒê√£ h·ªßy' : o.status.name()))))}">
          </span>
        </td>

        <td>
          <div class="actions">
            <a class="btn" th:href="@{/staff/orders/{id}(id=${o.orderId})}">Chi ti·∫øt</a>

            <form th:if="${o.status.name() == 'PROCESSING'}"
                  th:action="@{/staff/orders/{id}/confirm(id=${o.orderId})}" method="post"
                  onsubmit="return confirm('X√°c nh·∫≠n ƒë∆°n n√†y?');">
              <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
              <button class="btn primary" type="submit">Confirm</button>
            </form>

            <form th:if="${o.status.name() == 'CONFIRMED'}"
                  th:action="@{/staff/orders/{id}/ship(id=${o.orderId})}" method="post"
                  onsubmit="return confirm('Chuy·ªÉn sang SHIPPING?');">
              <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
              <button class="btn primary" type="submit">Ship</button>
            </form>

            <form th:if="${o.status.name() == 'SHIPPING'}"
                  th:action="@{/staff/orders/{id}/complete(id=${o.orderId})}" method="post"
                  onsubmit="return confirm('Ho√†n t·∫•t (COMPLETED)?');">
              <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
              <button class="btn primary" type="submit">Complete</button>
            </form>

            <form th:if="${o.status.name() == 'PROCESSING' or o.status.name() == 'CONFIRMED'}"
                  th:action="@{/staff/orders/{id}/cancel(id=${o.orderId})}" method="post"
                  onsubmit="return confirm('H·ªßy ƒë∆°n n√†y?');">
              <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
              <button class="btn danger" type="submit">Cancel</button>
            </form>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

</th:block>
