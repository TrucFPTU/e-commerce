<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="body">

    <style>
        .wrap { display:flex; flex-direction:column; gap:12px; }
        .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; }
        .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
        .muted { color:#6b7280; font-size:12px; }
        .code { font-weight:800; font-size:16px; }
        .grid { display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:10px; }
        .kv { border:1px solid #e5e7eb; border-radius:12px; padding:12px; background:#fafafa; }
        .kv b { display:block; font-size:12px; color:#6b7280; margin-bottom:6px; }
        .kv span { font-size:14px; color:#111827; word-break:break-word; }

        .badge {
            display:inline-flex; align-items:center; gap:6px;
            padding:4px 10px; border-radius:999px; font-size:12px;
            border:1px solid #e5e7eb; background:#f9fafb; color:#111827;
            white-space:nowrap;
        }

        .btn {
            display:inline-flex; align-items:center; gap:6px;
            height:34px; padding:0 12px; border-radius:10px;
            border:1px solid #e5e7eb; background:#fff; cursor:pointer;
            font-size:13px; color:#111827; text-decoration:none;
        }
        .btn:hover { background:#f3f4f6; }
        .btn.primary { background:#111827; color:#fff; border-color:#111827; }
        .btn.primary:hover { background:#0b1220; }
        .btn.danger { background:#fff; border-color:#fecaca; color:#b91c1c; }
        .btn.danger:hover { background:#fef2f2; }

        table { width:100%; border-collapse:collapse; margin-top:10px; }
        th, td { text-align:left; padding:10px 10px; border-top:1px solid #e5e7eb; font-size:13px; vertical-align:top; }
        th { background:#f9fafb; font-weight:600; border-top:none; }

        @media (max-width: 900px) {
            .grid { grid-template-columns: 1fr; }
        }
    </style>

    <div class="wrap">

        <!-- Header -->
        <div class="card">
            <div class="row">
                <div>
                    <div class="code" th:text="${order.orderCode}">ODR-XXXX</div>
                    <div class="muted">
                        ID: <span th:text="${order.orderId}">1</span> ‚Ä¢
                        ƒê·∫∑t l√∫c: <span th:text="${order.placedAt}">time</span>
                    </div>
                </div>

                <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <span class="badge"
                th:text="${order.status.name() == 'PROCESSING' ? 'üü° Ch·ªù x√°c nh·∫≠n' :
                         (order.status.name() == 'CONFIRMED' ? 'üîµ ƒê√£ x√°c nh·∫≠n' :
                         (order.status.name() == 'SHIPPING' ? 'üü£ ƒêang giao' :
                         (order.status.name() == 'COMPLETED' ? 'üü¢ Ho√†n t·∫•t' :
                         (order.status.name() == 'CANCELLED' ? 'üî¥ ƒê√£ h·ªßy' : order.status.name()))))}">
          </span>

                    <a class="btn" th:href="@{/staff/orders(status=${order.status.name()})}">‚Üê Quay l·∫°i danh s√°ch</a>
                </div>
            </div>

            <!-- Actions theo status (gi·ªëng list, nh∆∞ng ƒë·∫∑t ·ªü detail cho ti·ªán thao t√°c) -->
            <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
                <form th:if="${order.status.name() == 'PROCESSING'}"
                      th:action="@{/staff/orders/{id}/confirm(id=${order.orderId})}" method="post"
                      onsubmit="return confirm('X√°c nh·∫≠n ƒë∆°n n√†y?');">
                    <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button class="btn primary" type="submit">Confirm</button>
                </form>

                <form th:if="${order.status.name() == 'CONFIRMED'}"
                      th:action="@{/staff/orders/{id}/ship(id=${order.orderId})}" method="post"
                      onsubmit="return confirm('Chuy·ªÉn sang SHIPPING?');">
                    <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button class="btn primary" type="submit">Ship</button>
                </form>

                <form th:if="${order.status.name() == 'SHIPPING'}"
                      th:action="@{/staff/orders/{id}/complete(id=${order.orderId})}" method="post"
                      onsubmit="return confirm('Ho√†n t·∫•t (COMPLETED)?');">
                    <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button class="btn primary" type="submit">Complete</button>
                </form>

                <form th:if="${order.status.name() == 'PROCESSING' or order.status.name() == 'CONFIRMED'}"
                      th:action="@{/staff/orders/{id}/cancel(id=${order.orderId})}" method="post"
                      onsubmit="return confirm('H·ªßy ƒë∆°n n√†y?');">
                    <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button class="btn danger" type="submit">Cancel</button>
                </form>

                <span class="muted" style="align-self:center;">
          Staff ch·ªâ ƒë∆∞·ª£c ƒëi ƒë√∫ng b∆∞·ªõc theo flow (service ƒë√£ validate).
        </span>
            </div>
        </div>

        <!-- Th√¥ng tin kh√°ch + giao h√†ng -->
        <div class="card">
            <div style="font-weight:700;">Th√¥ng tin ƒë∆°n h√†ng</div>

            <div class="grid">
                <div class="kv">
                    <b>Kh√°ch h√†ng</b>
                    <span th:text="${order.user != null ? order.user.fullName : 'N/A'}">customer@email</span>
                </div>

                <div class="kv">
                    <b>S·ªë ƒëi·ªán tho·∫°i</b>
                    <span th:text="${order.phone}">phone</span>
                </div>

                <div class="kv">
                    <b>ƒê·ªãa ch·ªâ</b>
                    <span th:text="${order.address}">address</span>
                </div>

                <div class="kv">
                    <b>T·ªïng ti·ªÅn</b>
                    <span th:text="${#numbers.formatDecimal(order.total, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'">0 ‚Ç´</span>
                </div>
            </div>
        </div>

        <!-- Items -->
        <div class="card">
            <div style="font-weight:700; margin-bottom:8px;">S·∫£n ph·∫©m trong ƒë∆°n</div>

            <table>
                <thead>
                <tr>
                    <th>T√™n s·∫£n ph·∫©m</th>
                    <th style="width:140px;">ƒê∆°n gi√°</th>
                    <th style="width:90px;">SL</th>
                    <th style="width:140px;">Th√†nh ti·ªÅn</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${items == null or #lists.isEmpty(items)}">
                    <td colspan="4" class="muted" style="padding:12px;">Kh√¥ng c√≥ s·∫£n ph·∫©m.</td>
                </tr>

                <tr th:each="it : ${items}">
                    <td th:text="${it.productNameSnapshot}">name</td>
                    <td th:text="${#numbers.formatDecimal(it.unitPriceSnapshot, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'">0 ‚Ç´</td>
                    <td th:text="${it.quantity}">1</td>
                    <td th:text="${#numbers.formatDecimal(it.lineTotal, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'">0 ‚Ç´</td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>
</th:block>
